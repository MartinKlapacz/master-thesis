\section{Amount Functions}\label{sec:amount-functions}


\section{Amount Function Requirements}

How often a code is supposed to be billed in a billing is also highly relevant.

In the previous section, we explained how the billing framework derives a set of applicable billing codes.

However, the question of how often we want to bill a code is also highly relevant.

In the previous section, the framework derived a set of billing codes for a treatment.
The result type was a set of billing codes.

In this section, we generalize the framework in such a way that
it returns the code in combination with the number of times it should be billed.
Now the framework returns a set of pairs, one entry being the code and the second entry an integer which indicates the code's amount.

We extend the general rule structure by introducing the concept of amount functions.
Similarly to rule conditions, amount functions are evaluatable subcomponents of a rule.
The framework evaluates amount functions of rules for a\code{RuleEvaluationInput}.
The result is an integer that indicates how often it should be billed in the billing.

\begin{equation}
    \label{eq:amount-function-natural}
    f_{amount}: \code{RuleEvaluationInput} \longrightarrow \mathbb{N}
\end{equation}

Billing code amounts typically rely on two types of billing information.
Subsection\ref{subsec:amount-derivation-from-procedure-information} and\ref{subsec:amount-derivation-from-durations} explain these sources.

\subsection{Amount Derivation From Procedure Information}\label{subsec:amount-derivation-from-procedure-information}

\goa{255: Injection, intra-articular or perineural}\cite{hermanns2013bemessung} is an example of a code that is likely to be billed multiple times in a single billing.

The so-called Spine Infiltration is a procedure, that includes injections into spine nerves.
Billing experts use \goa{255} for this medical service.
Procedure block \code{SpineInfiltrationMsg} represents this procedure.
However, \goa{255} is typically billed once for each injection the practitioner actually provided.
Therefore, a spine infiltration can include multiple injections at different localizations.

This is where a new requirement for the billing framework occurred.
The system should not only be able to derive \goa{255} for a provided spine infiltration, but should also be able to derive the correct quantity of \goa{255}.

To illustrate this example, it is worth mentioning that the human spine consists of three primary regions:
\begin{itemize}
    \item The cervical spine, the thoracic spine, and the lumbar spine.
    The cervical spine comprises the uppermost part of the spine, which is the neck and head.
    \item The thoracic spine, located in the middle, has twelve vertebrae attached to the rib cage, providing stability and structure to the upper body.
    \item Lastly, the lumbar spine at the lower back is made up of five larger vertebrae, designed to bear the body's weight and provide flexibility and movement.
\end{itemize}
Each region has well-defined localizations that can be targets for injections.
The \AVS stores the data of a spine infiltration in a \code{SpineInfiltrationMsg}procedure block.

The following code snipped displays a simplified version of it.
\lstinputlisting[
    language=protobuf3,
    style=protobuf,
    caption={Relevant localizations in a spine infiltration}
    label={lst:spineInfiltration},
]{code/proto/spineInfiltration.proto}


\code{SpineInfiltrationMsg} has a nested message\code{NerveRootBlockMsg}.
\code{NerveRootBlockMsg} contains the messages,\code{CervicalSpineMsg}\code{ThoracicSpineMsg} and\code{LumbarSpineMsg}.
These messages represent the before-mentioned sections of the human spine.
Each variable in these nested messages is of type \code{Laterality}and represents injections at the respective localization alongside the spine.
The laterality of an injection refers to the specific side or sides where the injection is administered in the spine localization.
This can be either on the left side, the right side, or on both sides.

To get the total number of injections, the system would need to peek into the nested messages,\code{CervicalSpineMsg}\code{ThoracicSpineMsg} and\code{LumbarSpineMsg} and read the total number of injections from the laterality values.
Additionally, the framework needs to be able to understand that \code{LATERALITY\_NONE} refers to zero and \code{LATERALITY\_LEFT} as well as\code{LATERALITY\_RIGHT} refer to one injection.
\code{LATERALITY\_BOTH} refers to two injections.
It is important to assign quantities to enum values.

\subsection{Amount Derivation From Durations}\label{subsec:amount-derivation-from-durations}

Many GOÄ codes specify not only a service content but also a time range.
If provided services exceed that time range the respective code can be billed more than once.

\goa{21: Incoming human genetic counseling, per commenced half-hour and session} is an example for such a code.
If the counseling takes one hour and 10 minutes, \goa{21} can be billed 3 times.
Similar codes are \goa{61: Assistance in the medical service of another doctor (Assistance), per commenced half-hour}
and \goa{85: Written expert opinion involving an effort exceeding the usual extent – possibly with scientific justification –, per commenced hour of work}
Codes that with that characteristic often end with \("\)per commenced hour\("\) or \("\)per commenced half-hour\("\) to indicate the time range.
Those are comparably simple cases.

\mete{Section D: Anesthesia Services} contains a specific class of edge case that use time ranges.

\goa{462: Combined anesthesia with endotracheal intubation, up to one hour} and \goa{463: Combined anesthesia with endotracheal intubation, each additional commenced half-hour}
both denote the same procedure provided, but as their names suggest, they distinguish between different periods of service provision.
\goa{462} is applicable only once per procedure.
On the other hand, code \goa{463} covers each additional half-hour beyond the initial hour.
Its billing number is variable and depends on the total duration of the anesthesia.
\goa{463} excludes the first hour of service provision, already covered under code \goa{462}.

The GOÄ distinguishes between \goa{462} and \goa{463} because of the following reasons.
\goa{462} covers both the induction and the maintenance of anesthesia for the first hour.
This is the most critical phase involving continuous administration of medication to make sure the patient remains asleep.
The time after the first hour typically requires only maintenance of anesthesia and is therefore less critical.
\goa{463} applies to subsequent commenced half-hours after the first hour and is therefore lower priced than \goa{462}.


Anesthesia services frequently use this pattern of code groups referring to the same provided procedure but distinguishing between service periods.
Equivalent examples are \goa{460/461}, \goa{476/477} and \goa{478/479}.
\goa{473, 474 and 475} are a more special example.
They refer to an initiation and monitoring of a continuous subarachnoid spinal anesthesia, again distinguishing between durations.
\goa{473} applies to durations shorter than five hours, \goa{474} to the subsequent five hours and \goa{475} applies once for the second and every subsequent day.

These examples lead to concrete requirements for the billing framework and underline the importance of \"amount functions\".
They must be expressive enough to represent and manage the nuances of these examples.
Section\ref{sec:amount-function-specification} illustrates how users can express these cases using the rule language.

\subsection{Partial Billing Amounts}\label{subsec:partial-billing-amounts}
In very special cases billing codes apply with a reduced amount of points.

There are at least two cases:
\goa{D} is a surcharge for services provided on saturday, sunday and on holidays.
If service provision happens during an opening hour, \goa{D} only applies with half the fee, though.
This is also the case for surcharges \goa{E}, \goa{F}, \goa{G} and \goa{H} if \goa{51} is part of the billing, as well.

The framework must be able to express these edge cases but does not allow any point value manipulations of billing codes.
It solves this issue using amount functions.
In those cases the amount function must be able to evaluate to 0.5 which results in the same fee reduction as required by the GOÄ specification.

This requirement changes the formal definition given in formula \ref{eq:amount-function-natural} to:
\begin{equation}
    \label{eq:amount-function-real}
    f_{amount}: \code{RuleEvaluationInput} \longrightarrow \mathbb{R}^{+} \\ \left{0\right}
\end{equation}
Amount function now evaluate

